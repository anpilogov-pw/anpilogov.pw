<script setup lang="ts">
import { useOgImageRuntimeConfig } from "#og-image/app/utils";
import { computed } from "vue";

type Props = {
  colorMode?: "dark" | "light";
  title?: string;
  description?: string;
  theme?: string;
};

const props = withDefaults(defineProps<Props>(), {
  colorMode: "dark",
  description: "",
  theme: "#00dc82",
  title: "title",
});

const HexRegex = /^#(?:[0-9a-f]{3}){1,2}$/i;

const runtimeConfig = useOgImageRuntimeConfig();

const colorMode = computed(() => {
  return props.colorMode || runtimeConfig.colorPreference || "light";
});

const themeHex = computed(() => {
  if (HexRegex.test(props.theme)) return props.theme;

  if (HexRegex.test(`#${props.theme}`)) return `#${props.theme}`;

  if (props.theme.startsWith("rgb")) {
    const rgb = props.theme
      .replace("rgb(", "")
      .replace("rgba(", "")
      .replace(")", "")
      .split(",")
      .map((v) => Number.parseInt(v.trim(), 10));
    const hex = rgb
      .map((v) => {
        const hex = v.toString(16);
        return hex.length === 1 ? `0${hex}` : hex;
      })
      .join("");
    return `#${hex}`;
  }
  return "#FFFFFF";
});

const themeRgb = computed(() => {
  return themeHex.value
    .replace("#", "")
    .match(/.{1,2}/g)
    ?.map((v) => Number.parseInt(v, 16))
    .join(", ");
});
</script>

<template>
  <div
    class="w-full h-full flex justify-between relative p-[60px]"
    :class="[
      colorMode === 'light'
        ? ['bg-white', 'text-gray-900']
        : ['bg-gray-900', 'text-white'],
    ]"
  >
    <div
      class="flex absolute top-0 right-[-100%]"
      :style="{
        width: '200%',
        height: '200%',
        backgroundImage: `radial-gradient(circle, rgba(${themeRgb}, 0.5) 0%,  ${colorMode === 'dark' ? 'rgba(5, 5, 5,0.3)' : 'rgba(255, 255, 255, 0.7)'} 50%, ${props.colorMode === 'dark' ? 'rgba(5, 5, 5,0)' : 'rgba(255, 255, 255, 0)'} 70%)`,
      }"
    ></div>
    <div class="h-full w-full justify-between relative">
      <div class="flex flex-row justify-between items-start">
        <div class="flex flex-col w-full max-w-[65%]">
          <h1
            class="m-0 font-bold mb-[30px] text-[75px]"
            style="display: block; text-overflow: ellipsis"
            :style="{ lineClamp: description ? 2 : 3 }"
          >
            {{ title }}
          </h1>
          <p
            v-if="description"
            class="text-[35px] leading-12"
            :class="[
              colorMode === 'light' ? ['text-gray-700'] : ['text-gray-300'],
            ]"
            style="display: block; line-clamp: 3; text-overflow: ellipsis"
          >
            {{ description }}
          </p>
        </div>
      </div>
      <div class="flex flex-row justify-start items-start text-left w-full">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="213"
          height="30"
          class="mr-3"
          fill="none"
          viewBox="0 0 213 30"
        >
          <path
            fill="#fff"
            d="M.748 24 9.484 4.4h4.48L22.728 24h-4.76L10.8 6.696h1.792L5.396 24H.748Zm4.368-4.2 1.204-3.444H16.4l1.232 3.444H5.116ZM33.609 8.712c1.195 0 2.26.243 3.192.728.953.467 1.7 1.195 2.24 2.184.542.97.813 2.221.813 3.752V24h-4.368v-7.952c0-1.213-.271-2.11-.813-2.688-.522-.579-1.269-.868-2.24-.868-.69 0-1.316.15-1.875.448-.542.28-.971.719-1.288 1.316-.3.597-.448 1.363-.448 2.296V24h-4.369V8.936h4.172v4.172l-.784-1.26a5.58 5.58 0 0 1 2.325-2.324c1.008-.541 2.155-.812 3.443-.812Zm19.108 15.512c-1.27 0-2.38-.28-3.332-.84-.952-.56-1.699-1.41-2.24-2.548-.523-1.157-.784-2.613-.784-4.368 0-1.773.252-3.23.756-4.368.504-1.139 1.232-1.988 2.184-2.548.952-.56 2.09-.84 3.416-.84 1.419 0 2.688.327 3.808.98a6.893 6.893 0 0 1 2.688 2.688c.672 1.157 1.008 2.52 1.008 4.088 0 1.587-.336 2.959-1.008 4.116a6.893 6.893 0 0 1-2.688 2.688c-1.12.635-2.39.952-3.808.952Zm-8.904 5.208V8.936h4.172v3.08l-.084 4.48.28 4.452v8.484h-4.368Zm8.148-8.792c.728 0 1.372-.168 1.932-.504a3.612 3.612 0 0 0 1.372-1.428c.355-.635.532-1.381.532-2.24 0-.877-.177-1.624-.532-2.24a3.612 3.612 0 0 0-1.372-1.428c-.56-.336-1.204-.504-1.932-.504s-1.381.168-1.96.504a3.611 3.611 0 0 0-1.372 1.428c-.336.616-.504 1.363-.504 2.24 0 .859.168 1.605.504 2.24A3.611 3.611 0 0 0 50 20.136c.579.336 1.232.504 1.96.504ZM63.145 24V8.936h4.368V24h-4.368Zm2.184-17.164c-.803 0-1.456-.233-1.96-.7a2.27 2.27 0 0 1-.756-1.736c0-.69.252-1.27.756-1.736.504-.467 1.157-.7 1.96-.7.803 0 1.456.224 1.96.672.504.43.756.99.756 1.68 0 .728-.252 1.335-.756 1.82-.485.467-1.139.7-1.96.7ZM71.567 24V3.224h4.368V24h-4.368Zm15.59.224c-1.606 0-3.034-.336-4.284-1.008a7.847 7.847 0 0 1-2.94-2.744c-.71-1.176-1.064-2.51-1.064-4.004 0-1.512.354-2.847 1.064-4.004a7.562 7.562 0 0 1 2.94-2.744c1.25-.672 2.678-1.008 4.284-1.008 1.586 0 3.005.336 4.256 1.008 1.25.653 2.23 1.559 2.94 2.716.709 1.157 1.064 2.501 1.064 4.032 0 1.493-.355 2.828-1.064 4.004-.71 1.157-1.69 2.072-2.94 2.744-1.251.672-2.67 1.008-4.256 1.008Zm0-3.584c.728 0 1.381-.168 1.96-.504a3.612 3.612 0 0 0 1.372-1.428c.336-.635.504-1.381.504-2.24 0-.877-.168-1.624-.504-2.24a3.612 3.612 0 0 0-1.372-1.428c-.579-.336-1.232-.504-1.96-.504s-1.382.168-1.96.504a3.81 3.81 0 0 0-1.4 1.428c-.336.616-.504 1.363-.504 2.24 0 .859.168 1.605.504 2.24a3.81 3.81 0 0 0 1.4 1.428c.578.336 1.232.504 1.96.504Zm18.263 9.016a15.86 15.86 0 0 1-4.116-.532c-1.306-.336-2.398-.85-3.276-1.54l1.736-3.136c.635.523 1.438.933 2.408 1.232.99.317 1.96.476 2.912.476 1.55 0 2.67-.345 3.36-1.036.71-.69 1.064-1.717 1.064-3.08v-2.268l.28-3.78-.056-3.808V8.936h4.144V21.48c0 2.8-.728 4.863-2.184 6.188-1.456 1.325-3.546 1.988-6.272 1.988Zm-.672-6.384c-1.4 0-2.669-.299-3.808-.896a7.411 7.411 0 0 1-2.716-2.548c-.672-1.101-1.008-2.38-1.008-3.836 0-1.475.336-2.753 1.008-3.836a7.116 7.116 0 0 1 2.716-2.548c1.139-.597 2.408-.896 3.808-.896 1.27 0 2.39.261 3.36.784.971.504 1.727 1.297 2.268 2.38.542 1.064.812 2.436.812 4.116 0 1.661-.27 3.033-.812 4.116-.541 1.064-1.297 1.857-2.268 2.38-.97.523-2.09.784-3.36.784Zm.868-3.584c.766 0 1.447-.15 2.044-.448a3.52 3.52 0 0 0 1.4-1.316c.336-.56.504-1.204.504-1.932 0-.747-.168-1.39-.504-1.932a3.332 3.332 0 0 0-1.4-1.288c-.597-.317-1.278-.476-2.044-.476-.765 0-1.446.159-2.044.476a3.528 3.528 0 0 0-1.428 1.288c-.336.541-.504 1.185-.504 1.932 0 .728.168 1.372.504 1.932.355.56.831.999 1.428 1.316.598.299 1.279.448 2.044.448Zm19.494 4.536c-1.606 0-3.034-.336-4.284-1.008a7.847 7.847 0 0 1-2.94-2.744c-.71-1.176-1.064-2.51-1.064-4.004 0-1.512.354-2.847 1.064-4.004a7.562 7.562 0 0 1 2.94-2.744c1.25-.672 2.678-1.008 4.284-1.008 1.586 0 3.005.336 4.256 1.008 1.25.653 2.23 1.559 2.94 2.716.709 1.157 1.064 2.501 1.064 4.032 0 1.493-.355 2.828-1.064 4.004-.71 1.157-1.69 2.072-2.94 2.744-1.251.672-2.67 1.008-4.256 1.008Zm0-3.584c.728 0 1.381-.168 1.96-.504a3.616 3.616 0 0 0 1.372-1.428c.336-.635.504-1.381.504-2.24 0-.877-.168-1.624-.504-2.24a3.616 3.616 0 0 0-1.372-1.428c-.579-.336-1.232-.504-1.96-.504s-1.382.168-1.96.504a3.803 3.803 0 0 0-1.4 1.428c-.336.616-.504 1.363-.504 2.24 0 .859.168 1.605.504 2.24a3.803 3.803 0 0 0 1.4 1.428c.578.336 1.232.504 1.96.504ZM139.967 24l-6.328-15.064h4.508l5.264 12.964h-2.24l5.46-12.964h4.2L144.475 24h-4.508Zm8.722 2.8 9.24-26.376h3.892l-9.24 26.376h-3.892Zm14.213-2.8V4.4h8.484c1.755 0 3.267.29 4.536.868 1.269.56 2.249 1.372 2.94 2.436.691 1.064 1.036 2.333 1.036 3.808 0 1.456-.345 2.716-1.036 3.78-.691 1.064-1.671 1.885-2.94 2.464-1.269.56-2.781.84-4.536.84h-5.964l2.016-2.044V24h-4.536Zm4.536-6.944-2.016-2.156h5.712c1.4 0 2.445-.299 3.136-.896.691-.597 1.036-1.428 1.036-2.492 0-1.083-.345-1.923-1.036-2.52-.691-.597-1.736-.896-3.136-.896h-5.712l2.016-2.156v11.116ZM187.622 24 181.21 4.4h4.704l5.572 17.36h-2.352l5.824-17.36h4.2l5.6 17.36h-2.268l5.712-17.36h4.34L206.13 24h-4.872l-4.956-15.232h1.288L192.494 24h-4.872Z"
          />
        </svg>
      </div>
    </div>
  </div>
</template>
